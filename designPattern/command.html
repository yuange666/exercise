<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<body>
<div id="ball" style="position:absolute;background:#000;width:50px;height:50px"></div> 输入小球移动后的位置:<input id="pos"/>
<button id="moveBtn">开始移动</button>
<button id="cancelBtn">cancel</button>
</body>
</body>
<script>
    //命令模式
    let tween = {
        linear: function (t, b, c, d) {
            return c * t / d + b;
        },
    };
    class Animate {
        constructor(dom) {
            this.dom = dom;
            this.startTime = 0;
            this.startPos = 0;
            this.endPos = 0;
            this.propertyName = null;
            this.easing = null;
            this.duration = null;
        }
        start(propertyName, endPos, duration, easing) {
            this.startTime = +new Date;
            this.startPos = this.dom.getBoundingClientRect()[propertyName];
            this.propertyName = propertyName;
            this.endPos = endPos;
            this.duration = duration;
            this.easing = tween[easing];
            let self=this;
            let timeId=setInterval(function () {
                if(self.step()===false){
                    clearInterval(timeId);
                }
            },19)
        }
        step(){
            let t=+new Date;
            if(t>=this.startTime+this.duration){
                this.update(this.endPos);
                return false;
            }
            let pos=this.easing(t-this.startTime,this.startPos,this.endPos-this.startPos,this.duration);
            this.update(pos);
        }
        update(pos){
            this.dom.style[this.propertyName]=pos+'px';
        }
    };
    var ball = document.getElementById( 'ball' );
    var pos = document.getElementById( 'pos' );
    var moveBtn = document.getElementById( 'moveBtn' );
    let cancelBtn=document.getElementById('cancelBtn');
    let moveCommand;
    moveBtn.onclick = function(){
        var animate = new Animate( ball );
        moveCommand=new MoveCommand(animate,pos.value);
        moveCommand.execute();
    };
    class MoveCommand{
        constructor(receiver,pos){
            this.receiver=receiver;
            this.pos=pos;
            this.oldPos=null;
        }
        execute(){
            this.receiver.start('left',this.pos,1000,'linear');
        }
        undo(){
            this.receiver.start('left',this.oldPos,1000,'linear');
        }
    }
    cancelBtn.onclick=function () {
        moveCommand.undo();
    }
</script>
</html>
